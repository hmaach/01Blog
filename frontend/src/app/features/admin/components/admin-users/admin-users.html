<div class="page">
  <main class="main">
    <div class="container">
      <div class="header">
        <div>
          <h1 class="title">User Management</h1>
          <p class="subtitle">Search and manage user accounts</p>
        </div>
        <a matButton routerLink="/admin" class="backButton"
          ><mat-icon>arrow_backward</mat-icon> Back to Dashboard</a
        >
      </div>

      <mat-card class="searchBox">
        <input
          type="text"
          placeholder="Search by username or display name..."
          [value]="searchQuery()"
          (input)="searchQuery.set($any($event.target).value)"
          class="searchInput"
        />
        <span class="resultCount">
          Found {{ users.length }} user{{ filteredUsers().length !== 1 ? 's' : '' }}
        </span>
      </mat-card>

      <div class="tableWrapper">
        <table class="table">
          <thead>
            <tr>
              <th>User</th>
              <th>Posts</th>
              <th>Subscribers</th>
              <th>Joined</th>
              <th>Role</th>
              <th>Status</th>
              <!-- <th>Actions</th> -->
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let user of users" [class.bannedRow]="user.status === 'banned'">
              <td class="userCell">
                <div class="userRow">
                  <!-- <img
                    [src]="user.avatar || '/placeholder.svg'"
                    [alt]="user.name"
                    class="userAvatar"
                  /> -->
                  <div>
                    <div class="userName authorName" (click)="openUserCardDialog(user.username)">
                      {{ user.name }}
                    </div>
                    <div
                      class="userUsername authorName"
                      (click)="openUserCardDialog(user.username)"
                    >
                      @{{ user.username }}
                    </div>
                  </div>
                </div>
              </td>

              <td>{{ user.postsCount }}</td>
              <td>{{ user.subscribersCount }}</td>
              <td>{{ user.createdAt | date : 'medium' }}</td>

              <td>
                <span
                  class="roleBadge"
                  [class.adminRole]="user.role == 'admin'"
                  [class.userRole]="user.role == 'user'"
                >
                  {{ user.role }}
                </span>
              </td>

              <td>
                <span
                  class="statusBadge"
                  [class.banned]="user.status === 'banned'"
                  [class.active]="user.status === 'active'"
                >
                  {{ user.status }}
                </span>
              </td>

              <!-- <td class="actionsCell">
                <button matButton="outlined" (click)="handleBanUser(user.id)">
                  {{ user.isBanned ? 'Unban' : 'Ban' }}
                </button>

                <button matButton="outlined" (click)="handleChangeRole(user.id)">
                  {{ user.role === 'user' ? 'Make Admin' : 'Make User' }}
                </button>

                <button matButton="filled" color="red" (click)="handleDeleteUser(user.id)">
                  Delete
                </button>
              </td> -->
            </tr>
            @if (isLoading) {
            <tr>
              <td [colSpan]="6" class="spinnerContainer">
                <app-spinner></app-spinner>
              </td>
              <!-- <mat-progress-spinner></mat-progress-spinner> -->
            </tr>
            }
          </tbody>
        </table>
      </div>

      <div *ngIf="filteredUsers().length === 0" class="emptyState">
        No users found matching your search
      </div>
    </div>
  </main>
</div>
