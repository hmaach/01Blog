<div class="page">
  <main class="main">
    <div class="container">
      <div class="header">
        <div>
          <h1 class="title">Reports Management</h1>
          <p class="subtitle">View and manage content and user reports</p>
        </div>

        <a matButton routerLink="/admin" class="backButton"
          ><mat-icon>arrow_backward</mat-icon> Back to Dashboard</a
        >
      </div>

      <div class="statsGrid">
        <mat-card class="statCard">
          <div class="statHeader">
            <span class="statLabel"><mat-icon>group</mat-icon>User Reports</span>
            <i class="statIcon"></i>
          </div>
          <div class="statValue">{{ 154 }}</div>
        </mat-card>

        <mat-card class="statCard">
          <div class="statHeader">
            <span class="statLabel"><mat-icon>article</mat-icon>Post Reports</span>
            <i class="statIcon"></i>
          </div>
          <div class="statValue">{{ 124 }}</div>
        </mat-card>

        <mat-card class="statCard">
          <div class="statHeader">
            <span class="statLabel"><mat-icon>comment</mat-icon>Comment Reports</span>
            <i class="statIcon"></i>
          </div>
          <div class="statValue">{{ 11 }}</div>
        </mat-card>
      </div>

      <div class="reportsList">
        @if (isLoading) {
        <app-spinner></app-spinner>
        }@else{
        <mat-card *ngFor="let report of reports" class="reportItem">
          <div class="reportHeader">
            <div class="reportTitle">
              @if (report.reportedUser) {
              <h3
                class="userName authorName"
                (click)="openUserCardDialog(report.reportedUser.username)"
              >
                {{ report.reportedUser.name }}
              </h3>
              <p
                class="userHandle authorName"
                (click)="openUserCardDialog(report.reportedUser.username)"
              >
                @{{ report.reportedUser.username }}
              </p>
              }@else {
              <h3 class="userName">{{ 'DELETED USER' }}</h3>
              <p class="userHandle">@{{ 'deleted_user' }}</p>
              }
            </div>

            <div class="reportMeta">
              <span class="status">
                {{ report.reportedType }}
              </span>
              <span class="status" [ngClass]="'status-' + report.status">
                {{ report.status }}
              </span>
              <button matButton [matMenuTriggerFor]="menu">
                Actions <mat-icon>keyboard_arrow_down</mat-icon>
              </button>

              <mat-menu #menu="matMenu">
                <button mat-menu-item (click)="handleApprove(report.id)">
                  <mat-icon>check_circle</mat-icon> Approve
                </button>
                <button mat-menu-item (click)="handleDecline(report.id)">
                  <mat-icon>thumb_down</mat-icon> Decline
                </button>
                <button mat-menu-item (click)="handleDelete(report.id)">
                  <mat-icon>delete</mat-icon> Delete
                </button>
              </mat-menu>
            </div>
          </div>

          <div class="reportSection">
            <p class="reporter">
              Reported By @if (report.reporterUser) {
              <span
                class="reporter authorName"
                (click)="openUserCardDialog(report.reporterUser.username)"
              >
                @{{ report.reporterUser.username }}
              </span>
              }@else {
              <span class="reporter">{{ 'deleted_user' }}</span>
              } , at <span class="date">{{ report.createdAt | date : 'medium' }}</span>
            </p>
          </div>

          <div class="reportContent">
            <div class="reportSection">
              <label class="label">Report Category:</label>
              <p class="reason">{{ report.category }}</p>
            </div>

            <div class="reportSection">
              <label class="label">Report Reason:</label>
              <p class="reason">{{ report.reason }}</p>
            </div>
          </div>

          <div class="reportActions">
            @if (report.reportedType === "USER" && report.reportedUser) {
            <button matButton="outlined" (click)="openUserCardDialog(report.reportedUser.username)">
              See Profile
            </button>
            }@else if (report.reportedType === "POST" && report.reportedPostId) {
            <button matButton="outlined" (click)="openPostDetail(report.reportedPostId)">
              See Post
            </button>
            } @else if (report.reportedType === "COMMENT" && report.reportedCommentId) {
            <button matButton="outlined" (click)="openCommentDetail(report.reportedCommentId)">
              See Comment
            </button>
            }@else {
            <button matButton="outlined" disabled>DELETED {{ report.reportedType }}</button>
            }
          </div>
        </mat-card>
        }
      </div>
    </div>
  </main>
</div>
