<div class="page">
  <main class="main">
    <div class="container">
      <div class="statsGrid">
        <mat-card class="statCard">
          <div class="statHeader">
            <span class="statLabel">Total Users</span>
            <i class="statIcon"></i>
          </div>
          <div class="statValue">{{ totalUsers }}</div>
        </mat-card>

        <mat-card class="statCard">
          <div class="statHeader">
            <span class="statLabel">Total Posts</span>
            <i class="statIcon"></i>
          </div>
          <div class="statValue">{{ totalPosts }}</div>
        </mat-card>

        <mat-card class="statCard">
          <div class="statHeader">
            <span class="statLabel">Total Reports</span>
            <i class="statIcon"></i>
          </div>
          <div class="statValue">{{ totalReports }}</div>
        </mat-card>

        <mat-card class="statCard">
          <div class="statHeader">
            <span class="statLabel">Pending Reports</span>
            <i class="statIcon"></i>
          </div>
          <div class="statValue">{{ pendingReports }}</div>
        </mat-card>
      </div>

      <!-- USER MANAGEMENT -->
      <mat-card class="section">
        <div class="sectionHeader">
          <h2 class="sectionTitle">User Management</h2>
        </div>

        <table class="table">
          <thead>
            <tr>
              <th>User</th>
              <th>Role</th>
              <th>Posts</th>
              <th>Joined</th>
              <th>Actions</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let user of users">
              <td>
                <div class="userCell">
                  <img
                    [src]="user.avatar || '/placeholder-user.jpg'"
                    [alt]="user.name"
                    class="userAvatar"
                  />
                  <div class="userInfo">
                    <span class="userName">{{ user.name }}</span>
                    <span class="userUsername">@{{ user.username }}</span>
                  </div>
                </div>
              </td>

              <td>
                <span class="badge">
                  {{ user.role === 'admin' ? 'Admin' : 'User' }}
                </span>
              </td>

              <td>{{ user.stats.totalPosts }}</td>

              <td>
                {{ user.joinDate }}
              </td>

              <td>
                <div class="actions">
                  <button
                    class="actionButton"
                    (click)="handleChangeRole(user.id, user.role === 'admin' ? 'user' : 'admin')"
                  >
                    {{ user.role === 'admin' ? 'Make User' : 'Make Admin' }}
                  </button>

                  <button class="actionButton danger" (click)="handleBanUser(user.id)">Ban</button>

                  <button class="actionButton danger" (click)="handleDeleteUser(user.id)">
                    Delete
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </mat-card>

      <!-- REPORTS -->
      <mat-card class="section">
        <div class="sectionHeader">
          <h2 class="sectionTitle">Report Management</h2>
        </div>

        <table class="table">
          <thead>
            <tr>
              <th>Reported User</th>
              <th>Reporter</th>
              <th>Category</th>
              <th>Reason</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let report of reports">
              <td>
                <div class="userCell">
                  <div class="userInfo">
                    <span class="userName">{{ report.reportedUser.name }}</span>
                    <span class="userUsername">@{{ report.reportedUser.username }}</span>
                  </div>
                </div>
              </td>

              <td>
                <div class="userInfo">
                  <span class="userName">{{ report.reporter.name }}</span>
                  <span class="userUsername">@{{ report.reporter.username }}</span>
                </div>
              </td>

              <td>
                <span class="badge">{{ report.category }}</span>
              </td>

              <td>
                <div class="reportReason">
                  {{ report.reason }}
                </div>
              </td>

              <td>
                <span class="badge">
                  {{ report.status }}
                </span>
              </td>

              <td>
                <div class="actions">
                  <ng-container *ngIf="report.status === 'waiting'; else resolved">
                    <button
                      class="actionButton success"
                      (click)="handleUpdateReportStatus(report.id, 'approved')"
                    >
                      Approve
                    </button>

                    <button
                      class="actionButton danger"
                      (click)="handleUpdateReportStatus(report.id, 'declined')"
                    >
                      Decline
                    </button>
                  </ng-container>

                  <ng-template #resolved>
                    <span class="userUsername">Resolved</span>
                  </ng-template>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </mat-card>
    </div>
  </main>
</div>
