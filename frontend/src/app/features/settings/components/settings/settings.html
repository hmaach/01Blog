<div class="page">
  <main class="main">
    <div class="container">
      <div class="header">
        <h1 class="title">Settings</h1>
        <p class="subtitle">Manage your profile and account settings</p>
      </div>

      <mat-card *ngIf="isFetching" class="content">
        <app-spinner class="spinner"></app-spinner>
      </mat-card>
      <mat-card *ngIf="!isFetching" class="content">
        @if (isLoading) {
        <mat-progress-bar mode="indeterminate"></mat-progress-bar>
        }
        <mat-tab-group
          [selectedIndex]="activeTabIndex"
          (selectedIndexChange)="onTabChange($event)"
          class="tabs"
        >
          <mat-tab label="Profile"></mat-tab>
          <!-- <mat-tab label="README"></mat-tab> -->
          <!-- <mat-tab label="Password"></mat-tab>
          <mat-tab label="Account"></mat-tab> -->
        </mat-tab-group>

        <!-- ************************************ -->
        <!-- PROFILE TAB -->
        <!-- ************************************ -->
        <form [formGroup]="infoForm" class="section" *ngIf="activeTab === 'profile'">
          <h2 class="sectionTitle">Profile Settings</h2>

          <!-- Avatar -->
          <div class="formGroup">
            <label class="label">Profile Picture</label>
            <div class="avatarSection">
              <img
                [src]="avatar || userInfo.avatarUrl || '/assets/images/default-avatar.jpg'"
                class="avatarPreview"
                alt="Avatar"
              />

              <div class="avatarUpload">
                <label class="uploadLabel" [ngClass]="{ disabled: isLoading }">
                  <input
                    type="file"
                    accept="image/*"
                    [disabled]="isLoading"
                    (change)="handleAvatarChange($event)"
                    class="fileInput"
                  />
                  Choose Image
                </label>
                <p class="uploadHint">PNG, JPG OR JPEG (max 2MB)</p>
              </div>
            </div>
          </div>

          <!-- Display Name -->
          <div class="formGroup">
            <label class="label">Display Name</label>
            <mat-form-field appearance="fill" class="w-full">
              <input matInput formControlName="name" maxlength="{{ maxNameChars }}" />
              <mat-hint align="end">{{ infoForm.value.name?.length }}/{{ maxNameChars }}</mat-hint>
            </mat-form-field>
          </div>

          <!-- Email -->
          <div class="formGroup">
            <label class="label"
              >Email
              <span
                class="badge"
                [ngClass]="{
                  verified: userInfo.emailVerified,
                  notVerified: !userInfo.emailVerified
                }"
                >{{ userInfo.emailVerified ? 'Verified' : 'Not Verified' }}</span
              ></label
            >
            <div class="emailGroup">
              <mat-form-field appearance="fill" class="w-full">
                <input
                  matInput
                  type="email"
                  autocomplete="email"
                  formControlName="email"
                  maxlength="{{ maxEmailChars }}"
                />
                <mat-hint align="end"
                  >{{ infoForm.value.email?.length }}/{{ maxEmailChars }}</mat-hint
                >
              </mat-form-field>
              <!-- <span *ngIf="!emailVerified" class="badge">Not Verified</span> -->
            </div>
            <p class="hint">You can't change your email if it's verified</p>
          </div>

          <!-- Username -->
          <div class="formGroup">
            <label class="label">Username</label>
            <mat-form-field appearance="fill" class="w-full">
              <input matInput value="{{ userInfo.username }}" disabled />
            </mat-form-field>
            <p class="hint">Username cannot be changed</p>
          </div>
          <button
            [disabled]="infoForm.invalid || !isInfoFormValid()"
            mat-flat-button
            color="primary"
            (click)="handleSaveProfile()"
          >
            <mat-icon>save</mat-icon>
            Save Changes
          </button>
        </form>

        <!-- ************************************ -->
        <!-- README TAB -->
        <!-- ************************************ -->
        <!-- <form [formGroup]="readmeForm" *ngIf="activeTab === 'readme'" class="section">
          <h2 class="sectionTitle">Profile README</h2>

          <div class="readmeSteps">
            <div class="step">
              <div class="stepNumber">1</div>
              <div>
                <h3>Generate your README</h3>
                <p>
                  Visit
                  <a
                    href="https://rahuldkjain.github.io/gh-profile-readme-generator/"
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    GitHub Profile README Generator
                  </a>
                  to create your markdown file
                </p>
              </div>
            </div>
            <div class="step">
              <div class="stepNumber">2</div>
              <div>
                <h3>Download the file</h3>
                <p>Save the generated README.md file to your computer</p>
              </div>
            </div>
            <div class="step">
              <div class="stepNumber">3</div>
              <div>
                <h3>Upload your file</h3>
                <p>Use the upload button below to add your README</p>
              </div>
            </div>
          </div>

          <div class="formGroup">
            <label class="label">Upload README.md</label>
            <label class="uploadLabel" [ngClass]="{ disabled: isLoading }">
              <input
                type="file"
                accept=".md"
                formControlName="readme"
                (change)="handleReadmeUpload($event)"
                class="fileInput"
              />
              Choose File
            </label>
          </div>

          <h3 class="previewTitle">Preview</h3>
          <div *ngIf="readmePreview" class="readmePreview">
            <markdown *ngIf="!isLoading" [data]="readmePreview"></markdown>
          </div>
          <button
            mat-flat-button
            color="primary"
            [disabled]="readmeForm.invalid || isLoading"
            (click)="handleSaveReadme()"
          >
            <mat-icon>save</mat-icon>
            Save README
          </button>
        </form> -->

        <!-- ************************************ -->
        <!-- PASSWORD TAB -->
        <!-- ************************************ -->
        <!-- <form [formGroup]="passwordForm" *ngIf="activeTab === 'password'" class="section">
          <h2 class="sectionTitle">Change Password</h2>

          <div class="formGroup">
            <label class="label">Current Password</label>
            <mat-form-field appearance="fill" class="w-full">
              <input
                matInput
                type="password"
                formControlName="currentPassword"
                maxlength="{{ maxPasswordChars }}"
              />
              <mat-hint align="end"
                >{{ passwordForm.value.currentPassword?.length }}/{{ maxPasswordChars }}</mat-hint
              >
            </mat-form-field>
          </div>

          <div class="formGroup">
            <label class="label">New Password</label>
            <mat-form-field appearance="fill" class="w-full">
              <input
                matInput
                type="password"
                formControlName="newPassword"
                maxlength="{{ maxPasswordChars }}"
              />
              <mat-hint align="end"
                >{{ passwordForm.value.newPassword?.length }}/{{ maxPasswordChars }}</mat-hint
              >
            </mat-form-field>
          </div>

          <div class="formGroup">
            <label class="label">Confirm Password</label>
            <mat-form-field appearance="fill" class="w-full">
              <input
                matInput
                type="password"
                formControlName="confirmPassword"
                maxlength="{{ maxPasswordChars }}"
              />
              <mat-hint align="end"
                >{{ passwordForm.value.confirmPassword?.length }}/{{ maxPasswordChars }}</mat-hint
              >
            </mat-form-field>
          </div>
          <button
            mat-flat-button
            color="primary"
            [disabled]="passwordForm.invalid || isLoading"
            (click)="handleChangePassword()"
          >
            <mat-icon>save</mat-icon>
            Save Password
          </button>
        </form> -->

        <!-- ************************************ -->
        <!-- ACCOUNT TAB -->
        <!-- ************************************ -->
        <!-- <div *ngIf="activeTab === 'account'" class="section">
          <h2 class="sectionTitle">Account Management</h2>

          <div class="dangerZone">
            <h3 class="dangerTitle">Danger Zone</h3>
            <p class="dangerDescription">Permanently delete your account.</p>
            <button
              mat-flat-button
              color="primary"
              [disabled]="isLoading"
              class="deleteButton"
              (click)="handleDeleteAccount()"
            >
              <mat-icon>trash</mat-icon> Delete Account
            </button>
          </div>
        </div> -->
      </mat-card>
    </div>
  </main>
</div>
