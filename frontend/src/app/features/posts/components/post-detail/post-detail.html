<div class="modalOverlay" (click)="closeDialog()">
  <mat-card class="modalContent" (click)="stopPropagation($event)">
    <div class="modalHeader">
      <div class="headerLeft">
        <img
          [src]="post.author.avatarUrl || '/assets/images/default-avatar.jpg'"
          [alt]="post.author.name"
          (click)="openUserCardDialog(post.author.username)"
          class="authorAvatar"
        />
        <div class="authorInfo">
          <h3 (click)="openUserCardDialog(post.author.username)">{{ post.author.name }}</h3>
          <p>@{{ post.author.username }} Â· {{ formatDate(post.createdAt) }}</p>
        </div>
      </div>

      <div class="headerActions">
        <div class="menuContainer">
          <button mat-icon-button [matMenuTriggerFor]="menu">
            <mat-icon>more_vert</mat-icon>
          </button>

          <mat-menu #menu="matMenu">
            @if (post.isOwner || isAdmin) { @if (post.isOwner) {
            <button mat-menu-item>
              <mat-icon>edit</mat-icon>
              <span>Edit</span>
            </button>
            } @if (isAdmin ) {
            <button mat-menu-item>
              <mat-icon>visibility_off</mat-icon>
              <span>Hide</span>
            </button>
            } @if (isAdmin || post.isOwner) {
            <button mat-menu-item>
              <mat-icon color="warn">delete</mat-icon>
              <span>Delete</span>
            </button>
            }}@else {
            <button mat-menu-item (click)="openReportDialog()">
              <mat-icon color="warn">report</mat-icon>
              <span>Report</span>
            </button>
            }
          </mat-menu>
        </div>

        <button mat-icon-button (click)="closeDialog()">
          <mat-icon>close</mat-icon>
        </button>
      </div>
    </div>

    <div class="modalBody">
      <h1 class="postTitle">{{ post.title }}</h1>
      <div class="postContent">{{ post.body }}</div>
      <div *ngIf="post.media && post.media.length > 0" class="postMedias">
        <img *ngFor="let m of post.media" [src]="m.url" [alt]="post.title" class="postMedia" />
      </div>

      <div class="postMetrics">
        <div class="metric" style="gap: 0">
          <button matIconButton class="{{ post.isLiked ? 'primary' : '' }}" (click)="toggleLike()">
            @if (post.isLiked) {
            <mat-icon>favorite</mat-icon>
            }@else {
            <mat-icon>favorite_border</mat-icon>
            }
          </button>
          <span>{{ post.likesCount || 0 }}</span>
        </div>
        <div class="metric">
          <mat-icon>comment</mat-icon>
          <span>{{ post.commentsCount || 0 }}</span>
        </div>
        <div class="metric">
          <mat-icon>visibility</mat-icon>
          <span>{{ post.impressionsCount || 0 }}</span>
        </div>
      </div>

      <div class="commentsSection">
        <h2 class="commentsHeader">Comments ({{ comments.length }})</h2>

        <div class="commentsList">
          <div *ngFor="let comment of comments" class="comment">
            <img
              [src]="comment.author.avatar || '/assets/images/default-avatar.jpg'"
              [alt]="comment.author.name"
              class="commentAvatar"
            />
            <div class="commentContent">
              <div class="commentAuthor">{{ comment.author.name }}</div>
              <div class="commentText">{{ comment.content }}</div>
              <div class="commentDate">{{ formatDate(comment.createdAt) }}</div>
            </div>
          </div>
        </div>

        <div class="commentForm">
          <textarea
            [(ngModel)]="commentText"
            class="commentInput"
            placeholder="Write a comment..."
          ></textarea>
          <button
            matButton="filled"
            class="primary"
            (click)="handleComment()"
            [disabled]="!commentText.trim()"
          >
            Post
          </button>
        </div>
      </div>
    </div>
  </mat-card>
</div>
